-- JoshHub Ultimate ‚Äî Full Single-Script (Key System + All Features)
-- Owner: JoshroxasScript
-- NOTE: Palitan ang CorrectKey, DiscordInvite, at WebhookURL ayon sa gusto mo.

-- Services
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")
local StarterGui = game:GetService("StarterGui")

-- CONFIG (palitan mo ito)
local CorrectKey    = "JoshKey123"                        -- exact key na ie-enter ng user
local DiscordInvite  = "https://discord.gg/YourServer"    -- ilalagay sa Get Key Here (mako-copy)
local WebhookURL     = "YOUR_WEBHOOK_HERE"                -- webhook para sa auto-accept logs; set to "" para hindi mag-send

-- Helper: safe request to Discord webhook (tries multiple request functions)
local function safeRequestWebhook(jsonBody)
    if not WebhookURL or WebhookURL == "" then return end
    local body = HttpService:JSONEncode(jsonBody)
    local headers = { ["Content-Type"] = "application/json" }
    pcall(function()
        if syn and syn.request then
            syn.request({ Url = WebhookURL, Method = "POST", Headers = headers, Body = body })
        elseif request then
            request({ Url = WebhookURL, Method = "POST", Headers = headers, Body = body })
        elseif http_request then
            http_request({ Url = WebhookURL, Method = "POST", Headers = headers, Body = body })
        elseif (typeof(game.HttpService) == "Instance") then
            -- Some environments may allow HttpService:PostAsync (rare)
            pcall(function() HttpService:PostAsync(WebhookURL, body, Enum.HttpContentType.ApplicationJson) end)
        end
    end)
end

-- Helper: copy to clipboard (tries setclipboard or syn.set_clipboard)
local function copyToClipboard(text)
    pcall(function()
        if setclipboard then
            setclipboard(text)
            return true
        elseif syn and syn.set_clipboard then
            syn.set_clipboard(text)
            return true
        elseif (clipboard and clipboard.set) then
            clipboard.set(text)
            return true
        end
    end)
    return false
end

-- Create main CoreGui container
local CoreGui = game:GetService("CoreGui")

-- Remove old instances if present
for _, name in ipairs({"JoshHub_KeyGui","JoshHub_MainGui","JoshHub_SpectateGui","JoshHub_LogoGui","JoshHub_Notifier"}) do
    local old = CoreGui:FindFirstChild(name)
    if old then old:Destroy() end
end

-- ============================
-- KEY SYSTEM UI (blocking)
-- ============================
local KeyGui = Instance.new("ScreenGui")
KeyGui.Name = "JoshHub_KeyGui"
KeyGui.ResetOnSpawn = false
KeyGui.Parent = CoreGui

local KeyFrame = Instance.new("Frame", KeyGui)
KeyFrame.Name = "KeyFrame"
KeyFrame.Size = UDim2.new(0, 380, 0, 170)
KeyFrame.Position = UDim2.new(0.5, -190, 0.5, -85)
KeyFrame.BackgroundColor3 = Color3.fromRGB(24,24,24)
KeyFrame.BorderSizePixel = 0
Instance.new("UICorner", KeyFrame).CornerRadius = UDim.new(0,10)

local KeyTitle = Instance.new("TextLabel", KeyFrame)
KeyTitle.Size = UDim2.new(1, -20, 0, 36)
KeyTitle.Position = UDim2.new(0,10,0,8)
KeyTitle.BackgroundTransparency = 1
KeyTitle.Font = Enum.Font.GothamBold
KeyTitle.TextSize = 18
KeyTitle.TextColor3 = Color3.fromRGB(255,210,120)
KeyTitle.Text = "üîê JoshHub ‚Äî Enter Key to Unlock"

local KeyBox = Instance.new("TextBox", KeyFrame)
KeyBox.Size = UDim2.new(0.86, 0, 0, 38)
KeyBox.Position = UDim2.new(0.07, 0, 0.28, 0)
KeyBox.BackgroundColor3 = Color3.fromRGB(36,36,36)
KeyBox.TextColor3 = Color3.fromRGB(255,255,255)
KeyBox.PlaceholderText = "Enter key here..."
KeyBox.Text = ""
KeyBox.ClearTextOnFocus = false
Instance.new("UICorner", KeyBox).CornerRadius = UDim.new(0,8)

local SubmitBtn = Instance.new("TextButton", KeyFrame)
SubmitBtn.Size = UDim2.new(0.42, 0, 0, 36)
SubmitBtn.Position = UDim2.new(0.06, 0, 0.64, 0)
SubmitBtn.BackgroundColor3 = Color3.fromRGB(50,160,60)
SubmitBtn.Font = Enum.Font.GothamBold
SubmitBtn.TextSize = 14
SubmitBtn.TextColor3 = Color3.fromRGB(255,255,255)
SubmitBtn.Text = "‚úÖ Submit"
Instance.new("UICorner", SubmitBtn).CornerRadius = UDim.new(0,8)

local GetKeyBtn = Instance.new("TextButton", KeyFrame)
GetKeyBtn.Size = UDim2.new(0.42, 0, 0, 36)
GetKeyBtn.Position = UDim2.new(0.52, 0, 0.64, 0)
GetKeyBtn.BackgroundColor3 = Color3.fromRGB(30,110,200)
GetKeyBtn.Font = Enum.Font.GothamBold
GetKeyBtn.TextSize = 14
GetKeyBtn.TextColor3 = Color3.fromRGB(255,255,255)
GetKeyBtn.Text = "Get Key Here"
Instance.new("UICorner", GetKeyBtn).CornerRadius = UDim.new(0,8)

local StatusLabel = Instance.new("TextLabel", KeyFrame)
StatusLabel.Size = UDim2.new(1, -20, 0, 22)
StatusLabel.Position = UDim2.new(0,10,0.9,0)
StatusLabel.BackgroundTransparency = 1
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.TextSize = 13
StatusLabel.Text = ""
StatusLabel.TextColor3 = Color3.fromRGB(255,120,120)

-- ============================
-- MAIN UI (hidden until key correct)
-- ============================
local MainGui = Instance.new("ScreenGui")
MainGui.Name = "JoshHub_MainGui"
MainGui.ResetOnSpawn = false
MainGui.Parent = CoreGui
MainGui.Enabled = false

-- Main Control Panel
local MainFrame = Instance.new("Frame", MainGui)
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 260, 0, 320)
MainFrame.Position = UDim2.new(0.03, 0, 0.22, 0)
MainFrame.BackgroundColor3 = Color3.fromRGB(25,25,25)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0,12)
local UIGradient = Instance.new("UIGradient", MainFrame)
UIGradient.Color = ColorSequence.new{ ColorSequenceKeypoint.new(0, Color3.fromRGB(255,100,50)), ColorSequenceKeypoint.new(1, Color3.fromRGB(60,20,20)) }
UIGradient.Rotation = 90

local MainTitle = Instance.new("TextLabel", MainFrame)
MainTitle.Size = UDim2.new(1, -48, 0, 36)
MainTitle.Position = UDim2.new(0,12,0,6)
MainTitle.BackgroundTransparency = 1
MainTitle.Font = Enum.Font.Fantasy
MainTitle.TextSize = 17
MainTitle.TextColor3 = Color3.fromRGB(255,200,100)
MainTitle.TextXAlignment = Enum.TextXAlignment.Left
MainTitle.Text = "üî• Joshhub Teleporter"

local MinBtn = Instance.new("TextButton", MainFrame)
MinBtn.Size = UDim2.new(0,32,0,32)
MinBtn.Position = UDim2.new(1,-40,0,6)
MinBtn.BackgroundColor3 = Color3.fromRGB(50,25,25)
MinBtn.Text = "-"
MinBtn.Font = Enum.Font.SourceSansBold
MinBtn.TextSize = 20
MinBtn.TextColor3 = Color3.fromRGB(255,180,120)
Instance.new("UICorner", MinBtn).CornerRadius = UDim.new(0,6)

-- AutoAccept Toggle
local SwitchLabel = Instance.new("TextLabel", MainFrame)
SwitchLabel.Size = UDim2.new(0,140,0,22)
SwitchLabel.Position = UDim2.new(0,12,0,50)
SwitchLabel.BackgroundTransparency = 1
SwitchLabel.Font = Enum.Font.GothamBold
SwitchLabel.TextSize = 12
SwitchLabel.TextColor3 = Color3.fromRGB(255,255,255)
SwitchLabel.TextXAlignment = Enum.TextXAlignment.Left
SwitchLabel.Text = "Auto Accept Gift"

local SwitchFrame = Instance.new("TextButton", MainFrame)
SwitchFrame.Size = UDim2.new(0,50,0,24)
SwitchFrame.Position = UDim2.new(1,-64,0,48)
SwitchFrame.BackgroundColor3 = Color3.fromRGB(80,40,40)
SwitchFrame.Text = ""
Instance.new("UICorner", SwitchFrame).CornerRadius = UDim.new(0,12)

local Knob = Instance.new("Frame", SwitchFrame)
Knob.Size = UDim2.new(0,22,0,20)
Knob.Position = UDim2.new(0,2,0,2)
Knob.BackgroundColor3 = Color3.fromRGB(200,50,50)
Instance.new("UICorner", Knob).CornerRadius = UDim.new(0,10)

-- Player List (Teleport)
local PlayerList = Instance.new("ScrollingFrame", MainFrame)
PlayerList.Size = UDim2.new(1, -24, 0, 120)
PlayerList.Position = UDim2.new(0,12,0,82)
PlayerList.CanvasSize = UDim2.new(0,0,0,0)
PlayerList.BackgroundTransparency = 1
PlayerList.ScrollBarThickness = 6
local PlayerLayout = Instance.new("UIListLayout", PlayerList)
PlayerLayout.Padding = UDim.new(0,6)

-- Leave Button
local LeaveBtn = Instance.new("TextButton", MainFrame)
LeaveBtn.Size = UDim2.new(1, -24, 0, 32)
LeaveBtn.Position = UDim2.new(0,12,1,-42)
LeaveBtn.BackgroundColor3 = Color3.fromRGB(200,50,50)
LeaveBtn.TextColor3 = Color3.fromRGB(255,255,255)
LeaveBtn.Font = Enum.Font.SourceSansBold
LeaveBtn.TextSize = 14
LeaveBtn.Text = "‚ùå LEAVE KANA"
Instance.new("UICorner", LeaveBtn).CornerRadius = UDim.new(0,8)

-- Small config: WalkSpeed
local SpeedLabel = Instance.new("TextLabel", MainFrame)
SpeedLabel.Size = UDim2.new(0,120,0,20)
SpeedLabel.Position = UDim2.new(0,12,0,210)
SpeedLabel.BackgroundTransparency = 1
SpeedLabel.Font = Enum.Font.Gotham
SpeedLabel.TextSize = 12
SpeedLabel.TextColor3 = Color3.fromRGB(255,255,255)
SpeedLabel.Text = "WalkSpeed: 120"

-- ============================
-- SPECTATE GUI
-- ============================
local SpecGui = Instance.new("ScreenGui")
SpecGui.Name = "JoshHub_SpectateGui"
SpecGui.ResetOnSpawn = false
SpecGui.Parent = CoreGui
SpecGui.Enabled = false

local SpecFrame = Instance.new("Frame", SpecGui)
SpecFrame.Size = UDim2.new(0, 180, 0, 240)
SpecFrame.Position = UDim2.new(0.7, 0, 0.18, 0)
SpecFrame.BackgroundColor3 = Color3.fromRGB(25,25,25)
SpecFrame.Active = true
SpecFrame.Draggable = true
Instance.new("UICorner", SpecFrame).CornerRadius = UDim.new(0,10)

local SpecTitle = Instance.new("TextLabel", SpecFrame)
SpecTitle.Size = UDim2.new(1, -12, 0, 28)
SpecTitle.Position = UDim2.new(0,6,0,4)
SpecTitle.BackgroundTransparency = 1
SpecTitle.Font = Enum.Font.SourceSansBold
SpecTitle.TextSize = 14
SpecTitle.TextColor3 = Color3.fromRGB(255,200,120)
SpecTitle.TextXAlignment = Enum.TextXAlignment.Left
SpecTitle.Text = "üé• Spectate Players"

local SpecList = Instance.new("ScrollingFrame", SpecFrame)
SpecList.Size = UDim2.new(1, -10, 1, -62)
SpecList.Position = UDim2.new(0,5,0,34)
SpecList.BackgroundTransparency = 1
SpecList.ScrollBarThickness = 6
local SpecLayout = Instance.new("UIListLayout", SpecList)
SpecLayout.Padding = UDim.new(0,6)

local StopSpecBtn = Instance.new("TextButton", SpecFrame)
StopSpecBtn.Size = UDim2.new(1, -12, 0, 28)
StopSpecBtn.Position = UDim2.new(0,6,1,-32)
StopSpecBtn.BackgroundColor3 = Color3.fromRGB(200,50,50)
StopSpecBtn.Font = Enum.Font.SourceSansBold
StopSpecBtn.TextSize = 14
StopSpecBtn.TextColor3 = Color3.fromRGB(255,255,255)
StopSpecBtn.Text = "‚õî Stop Spectating"
Instance.new("UICorner", StopSpecBtn).CornerRadius = UDim.new(0,6)

-- ============================
-- LOGO / MINIMIZE BUTTON
-- ============================
local LogoGui = Instance.new("ScreenGui")
LogoGui.Name = "JoshHub_LogoGui"
LogoGui.ResetOnSpawn = false
LogoGui.Parent = CoreGui

local LogoBtn = Instance.new("TextButton", LogoGui)
LogoBtn.Size = UDim2.new(0,40,0,40)
LogoBtn.Position = UDim2.new(0,8,0,8)
LogoBtn.BackgroundColor3 = Color3.fromRGB(40,40,40)
LogoBtn.Text = "J"
LogoBtn.Font = Enum.Font.SourceSansBold
LogoBtn.TextSize = 20
LogoBtn.TextColor3 = Color3.fromRGB(255,200,120)
Instance.new("UICorner", LogoBtn).CornerRadius = UDim.new(1,0)

-- ============================
-- NOTIFIER (temporary message)
-- ============================
local NotifierGui = Instance.new("ScreenGui")
NotifierGui.Name = "JoshHub_Notifier"
NotifierGui.ResetOnSpawn = false
NotifierGui.Parent = CoreGui
NotifierGui.Enabled = false

local NoteFrame = Instance.new("Frame", NotifierGui)
NoteFrame.Size = UDim2.new(0, 320, 0, 46)
NoteFrame.Position = UDim2.new(1, -330, 1, -80)
NoteFrame.BackgroundColor3 = Color3.fromRGB(30,30,30)
NoteFrame.BorderSizePixel = 1
Instance.new("UICorner", NoteFrame).CornerRadius = UDim.new(0,8)

local NoteLabel = Instance.new("TextLabel", NoteFrame)
NoteLabel.Size = UDim2.new(1, -12, 1, 0)
NoteLabel.Position = UDim2.new(0,6,0,0)
NoteLabel.BackgroundTransparency = 1
NoteLabel.Font = Enum.Font.GothamBold
NoteLabel.TextSize = 14
NoteLabel.TextColor3 = Color3.fromRGB(255,255,255)
NoteLabel.TextXAlignment = Enum.TextXAlignment.Left

-- ============================
-- VARIABLES / STATE
-- ============================
getgenv().AutoAccept = false
local AutoAcceptAccepted = {}
local FirstGiftFlag = true
local DesiredWalkSpeed = 120
local InfJumpEnabled = true
local NoclipEnabled = true
local isMainVisible = true

-- ============================
-- FUNCTIONS
-- ============================
local function showNotifier(text, duration)
    duration = duration or 4
    NotifierGui.Enabled = true
    NoteLabel.Text = "‚úÖ " .. tostring(text)
    task.delay(duration, function()
        if NotifierGui then NotifierGui.Enabled = false end
    end)
end

local function trySendWebhookAccept(sender, giftId, petFinal)
    if not WebhookURL or WebhookURL == "" then return end
    local accDays = "N/A"
    local accYears = ""
    if sender and type(sender) == "table" then
        if sender.AccountAge then
            accDays = tostring(sender.AccountAge) .. " days"
            accYears = string.format(" (~%.1f years)", tonumber(sender.AccountAge)/365 or 0)
        end
    end
    local desc = string.format("From: %s\nAccount Age: %s%s\nGiftID: %s\nPet: %s\nReceiver: %s",
        tostring(sender or "Unknown"), accDays, accYears, tostring(giftId), tostring(petFinal or "Unknown"), LocalPlayer.Name)
    local payload = {
        username = "üéÅ Joshhub AutoAccept",
        content = ("Auto accepted gift!"),
        embeds = {{
            title = "üéÅ Auto Accepted Gift!",
            description = desc,
            color = 65280
        }}
    }
    safeRequestWebhook(payload)
end

local function teleportToPlayer(target)
    if not target then return end
    if not (LocalPlayer and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")) then return end
    if target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
        pcall(function()
            LocalPlayer.Character.HumanoidRootPart.CFrame = target.Character.HumanoidRootPart.CFrame
        end)
    end
end

local function buildPlayerList()
    -- Clear old
    for _, child in pairs(PlayerList:GetChildren()) do
        if child:IsA("TextButton") then child:Destroy() end
    end
    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer then
            local Btn = Instance.new("TextButton", PlayerList)
            Btn.Size = UDim2.new(1, -10, 0, 26)
            Btn.BackgroundColor3 = Color3.fromRGB(60,30,30)
            Btn.TextColor3 = Color3.fromRGB(255,200,120)
            Btn.Font = Enum.Font.SourceSansBold
            Btn.TextSize = 13
            Btn.Text = plr.DisplayName
            Instance.new("UICorner", Btn).CornerRadius = UDim.new(0,6)
            Btn.MouseButton1Click:Connect(function()
                teleportToPlayer(plr)
            end)
        end
    end
    PlayerList.CanvasSize = UDim2.new(0,0,0, PlayerLayout.AbsoluteContentSize.Y + 8)
end

local function buildSpectateList()
    for _, child in pairs(SpecList:GetChildren()) do
        if child:IsA("TextButton") then child:Destroy() end
    end
    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer then
            local Btn = Instance.new("TextButton", SpecList)
            Btn.Size = UDim2.new(1, -6, 0, 24)
            Btn.BackgroundColor3 = Color3.fromRGB(60,30,30)
            Btn.TextColor3 = Color3.fromRGB(255,200,120)
            Btn.Font = Enum.Font.SourceSansBold
            Btn.TextSize = 13
            Btn.Text = plr.DisplayName
            Instance.new("UICorner", Btn).CornerRadius = UDim.new(0,6)
            Btn.MouseButton1Click:Connect(function()
                if plr.Character and plr.Character:FindFirstChildOfClass("Humanoid") then
                    workspace.CurrentCamera.CameraSubject = plr.Character:FindFirstChildOfClass("Humanoid")
                end
            end)
        end
    end
    SpecList.CanvasSize = UDim2.new(0,0,0, SpecLayout.AbsoluteContentSize.Y + 8)
end

-- ============================
-- EVENT CONNECTIONS
-- ============================

-- Key GUI events
SubmitBtn.MouseButton1Click:Connect(function()
    if tostring(KeyBox.Text) == tostring(CorrectKey) then
        StatusLabel.TextColor3 = Color3.fromRGB(120,255,140)
        StatusLabel.Text = "‚úÖ Key accepted! Loading JoshHub..."
        task.wait(0.6)
        -- destroy key gui and enable main GUIs
        if KeyGui and KeyGui.Parent then KeyGui:Destroy() end
        MainGui.Enabled = true
        SpecGui.Enabled = true
        NotifierGui.Enabled = false
        buildPlayerList()
        buildSpectateList()
        showNotifier("Welcome to JoshHub", 4)
    else
        StatusLabel.TextColor3 = Color3.fromRGB(255,120,120)
        StatusLabel.Text = "‚ùå Invalid key. Try again."
        -- Shake effect (optional)
    end
end)

KeyBox.FocusLost:Connect(function(enter)
    if enter then
        SubmitBtn.MouseButton1Click:Fire()
    end
end)

GetKeyBtn.MouseButton1Click:Connect(function()
    local ok = copyToClipboard(DiscordInvite)
    if ok then
        StatusLabel.TextColor3 = Color3.fromRGB(255,230,120)
        StatusLabel.Text = "‚û° Discord invite copied to clipboard!"
    else
        StatusLabel.TextColor3 = Color3.fromRGB(255,120,120)
        StatusLabel.Text = "‚ö† Could not copy (executor may not support clipboard)."
    end
end)

-- Main UI interactions
MinBtn.MouseButton1Click:Connect(function()
    isMainVisible = not isMainVisible
    if not isMainVisible then
        for _, v in pairs(MainFrame:GetChildren()) do
            if v ~= MainTitle and v ~= MinBtn and not v:IsA("UICorner") and not v:IsA("UIGradient") then
                v.Visible = false
            end
        end
        MainFrame.Size = UDim2.new(0,260,0,48)
        MinBtn.Text = "+"
    else
        for _, v in pairs(MainFrame:GetChildren()) do
            if v ~= MainTitle and v ~= MinBtn and not v:IsA("UICorner") and not v:IsA("UIGradient") then
                v.Visible = true
            end
        end
        MainFrame.Size = UDim2.new(0,260,0,320)
        MinBtn.Text = "-"
    end
end)

LogoBtn.MouseButton1Click:Connect(function()
    MainGui.Enabled = not MainGui.Enabled
    SpecGui.Enabled = not SpecGui.Enabled
end)

LeaveBtn.MouseButton1Click:Connect(function()
    pcall(function() LocalPlayer:Kick("GAGO CONGRATS KUNG NAKANAKAW KAü§£") end)
end)

-- Toggle AutoAccept
local function toggleAutoAccept()
    getgenv().AutoAccept = not getgenv().AutoAccept
    if getgenv().AutoAccept then
        Knob:TweenPosition(UDim2.new(0,26,0,2),"Out","Sine",0.18,true)
        Knob.BackgroundColor3 = Color3.fromRGB(60,220,80)
        showNotifier("Auto Accept: ON", 2)
    else
        Knob:TweenPosition(UDim2.new(0,2,0,2),"Out","Sine",0.18,true)
        Knob.BackgroundColor3 = Color3.fromRGB(200,50,50)
        showNotifier("Auto Accept: OFF", 2)
    end
end
SwitchFrame.MouseButton1Click:Connect(toggleAutoAccept)

-- Stop spectating
StopSpecBtn.MouseButton1Click:Connect(function()
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") then
        workspace.CurrentCamera.CameraSubject = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
        showNotifier("Stopped spectating", 2)
    end
end)

-- Rebuild lists when players change
Players.PlayerAdded:Connect(function() 
    if MainGui.Enabled then buildPlayerList() end
    if SpecGui.Enabled then buildSpectateList() end
end)
Players.PlayerRemoving:Connect(function() 
    if MainGui.Enabled then buildPlayerList() end
    if SpecGui.Enabled then buildSpectateList() end
end)

-- ============================
-- ALWAYS-ON BEHAVIORS (speed, noclip, inf jump)
-- ============================
-- WalkSpeed enforcement
RunService.Stepped:Connect(function()
    if MainGui.Enabled and LocalPlayer and LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") then
        local humanoid = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
        if humanoid then
            humanoid.WalkSpeed = DesiredWalkSpeed
        end
    end
end)

-- Infinite Jump
UserInputService.JumpRequest:Connect(function()
    if InfJumpEnabled and LocalPlayer and LocalPlayer.Character then
        local humanoid = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
        if humanoid then
            humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
        end
    end
end)

-- NoClip
RunService.Stepped:Connect(function()
    if NoclipEnabled and LocalPlayer and LocalPlayer.Character then
        for _, part in pairs(LocalPlayer.Character:GetDescendants()) do
            if part:IsA("BasePart") then
                pcall(function() part.CanCollide = false end)
            end
        end
    end
end)

-- ============================
-- AUTO ACCEPT GIFT HOOKING
-- - Listens for any RemoteEvent with "gift" in its name
-- - Attempts to call a server "AcceptPetGift" equivalent if found
-- - Sends to webhook with pet details (if provided)
-- ============================
-- Try to find a server accept event (common path)
local serverAcceptEvent = nil
pcall(function()
    if ReplicatedStorage:FindFirstChild("GameEvents") and ReplicatedStorage.GameEvents:FindFirstChild("AcceptPetGift") then
        serverAcceptEvent = ReplicatedStorage.GameEvents.AcceptPetGift
    end
end)

-- Listen to any remote event in ReplicatedStorage with "gift" in the name
for _, rem in ipairs(ReplicatedStorage:GetDescendants()) do
    if rem:IsA("RemoteEvent") and string.find(string.lower(rem.Name), "gift") then
        rem.OnClientEvent:Connect(function(giftId, petInfo, sender)
            if not getgenv().AutoAccept then return end
            if not giftId then return end
            if AutoAcceptAccepted[giftId] then return end
            AutoAcceptAccepted[giftId] = true

            -- Delay logic: first gift immediate, subsequent gifts delayed 2s
            local delayTime = (FirstGiftFlag and 0) or 2
            FirstGiftFlag = false

            task.spawn(function()
                task.wait(delayTime)
                -- Try to fire server accept event if available
                pcall(function()
                    if serverAcceptEvent and serverAcceptEvent.FireServer then
                        serverAcceptEvent:FireServer(true, giftId)
                    else
                        -- try call generic remote if rem is the same remote that sent the event
                        -- many games use separate client events; can't guarantee success
                    end
                end)

                -- Pet formatting
                local petName = "Unknown"
                local petWeight = ""
                local petAge = ""
                if typeof(petInfo) == "table" then
                    petName = petInfo.name or petInfo.petName or petName
                    if petInfo.weight then petWeight = string.format(" [%.2f KG]", tonumber(petInfo.weight) or 0) end
                    if petInfo.age then petAge = string.format(" [Age %s]", tostring(petInfo.age)) end
                elseif typeof(petInfo) == "string" then
                    petName = petInfo
                end
                local petFinal = petName .. petWeight .. petAge

                -- Try to infer sender account age
                local accountAgeStr = "N/A"
                local accYears = ""
                if sender and type(sender) == "table" and sender.AccountAge then
                    accountAgeStr = tostring(sender.AccountAge) .. " days"
                    accYears = string.format(" (~%.1f years)", tonumber(sender.AccountAge)/365 or 0)
                end

                -- Send webhook log
                trySendWebhookAccept(sender, giftId, petFinal)

                -- Show notifier
                showNotifier("Auto accepted gift: "..tostring(petName), 4)
            end)
        end)
    end
end

-- ============================
-- INITIAL LOAD
-- ============================
-- Build lists initially (in case Key already correct)
buildPlayerList()
buildSpectateList()

-- Optional: unlock automatically if local key must be auto-accepted (but we keep Key GUI by default)
-- show Notifier on start
NotifierGui.Enabled = false

-- ============================
-- Final small polish: set initial UI states
-- ============================
Knob.Position = UDim2.new(0,2,0,2)
Knob.BackgroundColor3 = Color3.fromRGB(200,50,50)
MainGui.Enabled = false
SpecGui.Enabled = false

-- Provide a debug print
print("[JoshHub] Script loaded. Key GUI visible. Enter key to unlock full features.")
